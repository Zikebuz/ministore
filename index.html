<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Store - Premium Digital Products</title>
    
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        /* --- Global Styles --- */
        body {
            background-color: #2b3035; /* Dark Mode Default Background */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #f8f9fa; /* Light Text */
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* Flex wrapper to push footer to bottom */
        .content-wrapper {
            flex: 1;
        }

        /* --- Card Styling --- */
        .card {
            border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); /* Dark Mode Shadow */
            transition: transform 0.3s ease, background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
            background-color: #212529; /* Dark Card Background */
            color: #f8f9fa;
        }

        /* Light Mode Card Overrides */
        [data-bs-theme="light"] .card {
            background-color: #ffffff !important;
            color: #212529 !important;
            box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.08); /* Refined Light Mode Shadow */
        }

        /* Card Hover Effect */
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12); /* Lift & Enhance Shadow */
        }

        .product-img {
            padding: 10px;
            border-radius: 12px;
            width: 100%;
            height: auto;
            object-fit: cover;
        }
        
        /* --- Navbar Styling --- */
        .navbar {
            background-color: #212529; /* Dark Mode Navbar */
            overflow: hidden;
            transition: background-color 0.3s ease;
        }
        .navbar .container-fluid,
        .navbar .navbar-collapse {
            align-items: center;
        }
        .navbar .navbar-brand,
        .navbar .nav-link {
            padding-top: 12px;
            padding-bottom: 12px;
            display: inline-flex;
            align-items: center;
        }

        /* Light Mode Navbar */
        [data-bs-theme="light"] .navbar {
            background-color: #ffffff !important;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .navbar a {
            float: left;
            display: block;
            color: #f8f9fa;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
            font-size: 17px;
            transition: color 0.3s ease, background-color 0.3s ease;
        }

        /* Light Mode Navbar Links */
        [data-bs-theme="light"] .navbar a {
            color: #212529;
        }

        /* Navbar Link Hover */
        .navbar a:hover {
            color: #adb5bd; /* Gray Hover */
        }

        [data-bs-theme="light"] .navbar a:hover {
            color: #000000; /* Deep Black for Contrast */
            font-weight: 500;
        }

        .navbar a.active {
            background-color: #adb5bd;
            color: white;
        }
        
        /* Navbar Toggler (Hamburger Menu) */
        [data-bs-theme="light"] .navbar-toggler {
            border-color: rgba(0,0,0,0.1);
        }
        [data-bs-theme="light"] .navbar-toggler-icon {
            /* Dark Icon for Light Mode */
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%2833, 37, 41, 0.75%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
        }
        
        /* --- Footer Styling --- */
        .footer-custom {
            padding-top: 40px;
            padding-bottom: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Footer Links */
        .footer-links a {
            transition: color 0.3s ease-in-out, transform 0.3s ease-in-out;
            color: #f8f9fa;
            display: inline-block;
        }

        [data-bs-theme="light"] .footer-links a {
            color: #212529;
        }

        .footer-links a:hover {
            color: #adb5bd !important;
            transform: scale(1.05); /* Breathing Effect */
        }

        [data-bs-theme="light"] .footer-links a:hover {
            color: #000000 !important; /* Deep Black Contrast */
        }

        /* Footer Social Icons */
        .footer-icons a {
            transition: color 0.3s ease-in-out, transform 0.3s ease-in-out;
            color: #f8f9fa;
            margin-right: 15px;
        }

        [data-bs-theme="light"] .footer-icons a {
            color: #212529;
        }

        .footer-icons a:hover {
            transform: scale(1.2);
            color: #adb5bd;
        }

        [data-bs-theme="light"] .footer-icons a:hover {
            color: #000000;
        }

        /* Payment Icons */
        .payment-icon {
            font-size: 2rem;
            margin-right: 10px;
            color: #adb5bd;
        }

        [data-bs-theme="light"] .payment-icon {
            color: #495057;
        }
        
        /* Footer Bottom Links (Privacy/Terms) */
        .footer-bottom-link {
            color: #f8f9fa;
            transition: color 0.3s ease;
        }

        [data-bs-theme="light"] .footer-bottom-link {
            color: #212529;
        }

        .footer-bottom-link:hover {
            color: #adb5bd;
        }
        
        /* --- Theme Toggle Button --- */
        .theme-toggle {
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 50%;
            transition: background-color 0.3s;
            height: 44px;
            display: inline-flex;
            align-items: center;
        }
        .theme-toggle:hover {
            background-color: rgba(255,255,255,0.1);
        }

        /* --- Modal Styling --- */
        .policy-links a {
            color: #adb5bd;
            text-decoration: none;
            margin: 0 15px;
            transition: color 0.3s ease;
        }
        
        .policy-links a:hover {
            color: #fff;
            text-decoration: underline;
        }

        [data-bs-theme="dark"] .btn-light {
            border: 1px solid rgba(255,255,255,0.25);
            box-shadow: 0 0 0 6px rgba(255,255,255,0.06);
        }
        [data-bs-theme="dark"] .btn-light:hover {
            box-shadow: 0 0 0 8px rgba(255,255,255,0.10);
        }
        [data-bs-theme="light"] .btn-dark {
            border: 1px solid rgba(0,0,0,0.2);
            box-shadow: 0 0 0 6px rgba(0,0,0,0.04);
        }
        [data-bs-theme="light"] .btn-dark:hover {
            box-shadow: 0 0 0 8px rgba(0,0,0,0.08);
        }

        /* Theme-aware modal styles */
        [data-bs-theme="dark"] .modal-content {
            background-color: #212529;
            color: #f8f9fa;
        }
        [data-bs-theme="light"] .modal-content {
            background-color: #ffffff;
            color: #212529;
        }
        [data-bs-theme="dark"] .modal-header,
        [data-bs-theme="dark"] .modal-body {
            border-color: rgba(255,255,255,0.1);
        }
        [data-bs-theme="light"] .modal-header,
        [data-bs-theme="light"] .modal-body {
            border-color: rgba(0,0,0,0.1);
        }
        /* Close button contrast */
        [data-bs-theme="dark"] .btn-close {
            filter: invert(1);
        }
        [data-bs-theme="light"] .btn-close {
            filter: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3e%3cline x1='2' y1='2' x2='14' y2='14' stroke='rgba(33,37,41,0.95)' stroke-width='2'/%3e%3cline x1='14' y1='2' x2='2' y2='14' stroke='rgba(33,37,41,0.95)' stroke-width='2'/%3e%3c/svg%3e") !important;
            opacity: 1;
        }
        @media (max-width: 767.98px) {
            .footer-custom .row {
                align-items: left;
            }
            .footer-custom .col-md-3 {
                margin-bottom: 1.5rem;
            }
        }
        .footer-custom .copyright {
            font-size: 0.875rem;
            opacity: 0.85;
        }

        /* --- Navbar Social Icons --- */
        .nav-social-icon {
            color: #f8f9fa;
            transition: color 0.3s ease, transform 0.3s ease;
            text-decoration: none;
            height: 44px;
            display: inline-flex;
            align-items: center;
            margin-top: 0;
            margin-bottom: 0;
            margin-left: 0;
            margin-right: 10px !important;
            padding-top: 0;
            padding-bottom: 0;
            padding-left: 0;
            padding-right: 0;
        }
        .nav-social-icon:last-child {
            margin-right: 0 !important;
        }
        .nav-social-icon i { line-height: 1; }

        [data-bs-theme="light"] .nav-social-icon {
            color: #212529;
        }

        .nav-social-icon:hover {
            color: #adb5bd !important;
            transform: translateY(-2px);
        }

        [data-bs-theme="light"] .nav-social-icon:hover {
            color: #495057 !important;
        }

        /* --- Navbar Cart Icon --- */
        .cart-icon i {
            color: #f8f9fa;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        [data-bs-theme="light"] .cart-icon i {
            color: #212529;
        }

        .cart-icon:hover i {
            transform: translateY(-2px);
            color: #adb5bd;
        }

        [data-bs-theme="light"] .cart-icon:hover i {
            color: #495057;
        }
        
        /* --- Utility Classes --- */
        .text-muted-custom {
            color: #ced4da;
            transition: color 0.3s ease;
        }

        [data-bs-theme="light"] .text-muted-custom {
            color: #6c757d;
        }

        [data-bs-theme="light"] .cart-modal-content h6,
        [data-bs-theme="light"] .cart-modal-content .text-muted-custom,
        [data-bs-theme="light"] .cart-modal-content .fw-bold,
        [data-bs-theme="light"] .cart-modal-content #cart-total {
            color: #000;
        }

        /* --- Add to Cart Breathing Effect --- */
        .add-to-cart {
            transition: transform 0.3s ease;
        }
        .add-to-cart:hover {
            transform: scale(1.1);
        }

        .add-to-cart i {
            transition: transform 0.2s ease;
        }

        .add-to-cart:hover i {
            transform: translateY(-2px);
        }

        [data-bs-theme="dark"] .add-to-cart i {
            color: #ffffff;
        }

        [data-bs-theme="light"] .add-to-cart i {
            color: #000000;
        }

        /* Prevent Bootstrap outline buttons from filling on hover for Add to Cart */
        [data-bs-theme="dark"] .add-to-cart.btn-outline-light,
        [data-bs-theme="dark"] .add-to-cart.btn-outline-light:hover,
        [data-bs-theme="dark"] .add-to-cart.btn-outline-light:focus,
        [data-bs-theme="dark"] .add-to-cart.btn-outline-light:active {
            background-color: transparent !important;
            border-color: #f8f9fa;
            color: #f8f9fa;
        }

        [data-bs-theme="light"] .add-to-cart.btn-outline-dark,
        [data-bs-theme="light"] .add-to-cart.btn-outline-dark:hover,
        [data-bs-theme="light"] .add-to-cart.btn-outline-dark:focus,
        [data-bs-theme="light"] .add-to-cart.btn-outline-dark:active {
            background-color: transparent !important;
            border-color: #212529;
            color: #212529;
        }

        /* --- Back To Top Button --- */
        .back-to-top {
            position: fixed;
            right: 20px;
            bottom: 20px;
            z-index: 1050;
            display: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
        }
        .back-to-top.show {
            display: inline-flex;
        }
    </style>
</head>
<body data-bs-theme="dark" data-bs-spy="scroll" data-bs-target="#myTopnav" data-bs-offset="100">

    <!-- Header / Navbar -->
    <header id="home">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <!-- Brand -->
                <a class="navbar-brand" href="#home"><i class="bi bi-house-door-fill me-2"></i>Home</a>
                
                <!-- Mobile Toggle Button -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#myTopnav" aria-controls="myTopnav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <!-- Navbar Content -->
                <div class="collapse navbar-collapse" id="myTopnav">
                    <!-- Left Side Links -->
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link" href="https://api.whatsapp.com/send?phone=2348139498928" target="_blank"><span class="bi bi-whatsapp text-success me-2"></span>WhatsApp</a>
                        </li>
                    </ul>
                    
                    <!-- Right Side Items (Theme Toggle & Socials) -->
                    <div class="d-flex align-items-center ps-3">
                        <!-- Cart Icon (Desktop) -->
                        <div class="me-3 position-relative cart-icon" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#cartModal">
                            <i class="bi bi-cart fs-4"></i>
                            <span id="cart-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">
                                0
                                <span class="visually-hidden">items in cart</span>
                            </span>
                        </div>

                        <!-- Theme Toggle -->
                        <div class="me-4 theme-toggle" id="themeToggle" title="Toggle Dark/Light Mode">
                            <i class="bi bi-moon-fill" id="themeIcon"></i>
                        </div>
                        
                        <!-- Social Icons -->
                        <a href="https://web.facebook.com/jswithzikebuz/" target="_blank" class="nav-social-icon"><i class="bi bi-facebook fs-4"></i></a>
                        <a href="https://x.com/jswithzikebuz" class="nav-social-icon"><i class="bi bi-twitter-x fs-4"></i></a>
                        <a href="https://www.linkedin.com/in/jswithzikebuz/" class="nav-social-icon"><i class="bi bi-linkedin fs-4"></i></a>
                        <a href="https://www.instagram.com/jswithzikebuz/" class="nav-social-icon"><i class="bi bi-instagram fs-4"></i></a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <div class="content-wrapper container">
        
        <!-- Product 1: Rolex Watch -->
        <div class="card mb-4 mt-5" style="max-width: 900px; margin: 20px auto;">
            <div class="row no-gutters align-items-center">
                <div class="col-md-4 text-center">
                    <img src="\images\rolex-diamond.jpg" class="product-img" alt="Rolex Diamond Watch">
                </div>
                <div class="col-md-8">
                    <div class="card-body">
                        <h2 class="card-title"><strong>Rolex Diamond Wristwatch</strong></h2>
                        <h4 class="text-warning mb-3">$20.00</h4>
                        <div class="d-flex gap-2">
                            <a href="https://buy.stripe.com/test_bJe3cnfCz2Vjchv8o377O01" class="btn btn-light btn-lg buy-button flex-grow-1">Buy Now</a>
                            <button class="btn btn-outline-light btn-lg add-to-cart" data-id="rolex-watch" data-name="Rolex Diamond Wristwatch" data-price="20.00" data-price-id="price_1T5ATM04rfjoweArmHyzC0GD" data-image="\images\rolex-diamond.jpg">
                                <i class="bi bi-cart-plus"></i>
                            </button>
                        </div>
                        <p class="card-text mt-3 text-muted-custom">The Rolex Day-Date 40 in 18kt Everose gold is the ultimate expression of prestige and refinement. Featuring a diamond-paved dial and diamond-set bezel, this timepiece combines technical mastery with brilliant luxury.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product 2: Vibe Coding E-Book -->
        <div class="card mb-4" style="max-width: 900px; margin: 20px auto;">
            <div class="row no-gutters align-items-center">
                <div class="col-md-4 text-center">
                    <img src="\images\vibe-coding-cover.jpg" class="product-img" alt="Vibe Coding Book">
                </div>
                <div class="col-md-8">
                    <div class="card-body">
                        <h2 class="card-title"><strong>Vibe Coding E-Book</strong></h2>
                        <h4 class="text-warning mb-3">$10.00</h4>
                        <div class="d-flex gap-2">
                            <a href="https://buy.stripe.com/test_7sY9ALgGD1Rf5T77jZ77O02" class="btn btn-light btn-lg buy-button flex-grow-1">Buy Now</a>
                            <button class="btn btn-outline-light btn-lg add-to-cart" data-id="vibe-coding-book" data-name="Vibe Coding E-Book" data-price="10.00" data-price-id="price_1T5Ad204rfjoweArVrIgDjWe" data-image="\images\vibe-coding-cover.jpg">
                                <i class="bi bi-cart-plus"></i>
                            </button>
                        </div>
                        <p class="card-text mt-3 text-muted-custom">Vibe Coding is a modern, no-fluff guide that helps you think and build like a high-level developer. With clear explanations and real-world examples, it shows you how to write cleaner code, ship faster, and create products with confidence.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark mt-auto footer-custom">
        <div class="container">
            <div class="row">
                <!-- About Column -->
                <div class="col-md-3 mb-3">
                    <h5>About Us</h5>
                    <p>
                      Mini Store is your one-stop online shop for premium physical and digital goods-from sleek software and web apps to bestselling eBooks and beyond.
                    </p>
                </div>
                
                <!-- Links Column -->
                <div class="col-md-3 mb-3">
                    <h5>Links</h5>
                    <ul class="list-unstyled footer-links">
                        <li class="mb-2"><a href="index.html" class="text-decoration-none"><i class="bi bi-house-door me-2"></i>Home</a></li>
                        <li class="mb-2"><a href="#" data-bs-toggle="modal" data-bs-target="#cartModal" class="text-decoration-none"><i class="bi bi-cart me-2"></i>Cart</a></li>
                        <li class="mb-2"><a href="https://api.whatsapp.com/send?phone=2348139498928" target="_blank" class="text-decoration-none"><i class="bi bi-whatsapp me-2"></i>WhatsApp</a></li>
                    </ul>
                </div>
                
                <!-- Payment Options Column -->
                <div class="col-md-3 mb-3">
                    <h5>Payment Options</h5>
                    <div class="d-flex">
                        <i class="bi bi-credit-card-2-front payment-icon"></i>
                        <i class="bi bi-credit-card payment-icon"></i>
                        <i class="bi bi-stripe payment-icon"></i>
                    </div>
                </div>
                
                <!-- Social Follow Column -->
                <div class="col-md-3 mb-3">
                    <h5>Follow Us</h5>
                    <div class="d-flex footer-icons">
                        <a href="https://web.facebook.com/jswithzikebuz/" target="_blank"><i class="bi bi-facebook fs-2"></i></a>
                        <a href="https://x.com/jswithzikebuz"><i class="bi bi-twitter-x fs-2"></i></a>
                        <a href="#"><i class="bi bi-linkedin fs-2"></i></a>
                        <a href="https://www.instagram.com/jswithzikebuz/"><i class="bi bi-instagram fs-2"></i></a>
                    </div>
                </div>                                
            </div>
            
            <hr>
            
            <!-- Footer Bottom -->
            <div class="text-center mb-3">
                    <a href="#" class="footer-bottom-link text-decoration-none me-3" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</a>
                    <span>|</span>
                    <a href="#" class="footer-bottom-link text-decoration-none ms-3" data-bs-toggle="modal" data-bs-target="#tosModal">Terms of Service</a>
                </div>
            <div class="text-center">
                <p class="mb-0 copyright">Mini Store &copy; <span id="year"></span> | Designed by Ebuka</p>
            </div>
        </div>
    </footer>

    <!-- Back To Top Button -->
    <button type="button" class="btn back-to-top" id="backToTopBtn" aria-label="Scroll to top">
        <i class="bi bi-arrow-up"></i>
    </button>

    <!-- Privacy Policy Modal -->
    <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="privacyModalLabel">Privacy Policy</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>We value your privacy. This policy outlines how we collect, use, and protect your personal information when you use our website. We do not sell your data to third parties. All payment processing is securely handled by Stripe. By using our site, you consent to our privacy policy.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Terms of Service Modal -->
    <div class="modal fade" id="tosModal" tabindex="-1" aria-labelledby="tosModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="tosModalLabel">Terms of Service</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>By using this site, you agree that the content provided is for informational purposes. All projects, code samples, and intellectual property are property of Mini Store unless otherwise stated. Unauthorized duplication or commercial use without consent is prohibited.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content cart-modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cartModalLabel"><i class="bi bi-cart me-2"></i>Your Cart</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="cart-items-container">
                        <!-- Cart items will be injected here -->
                        <p class="text-center my-4">Your cart is empty.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="w-100 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Total: $<span id="cart-total">0.00</span></h5>
                        <button type="button" class="btn btn-success" id="checkout-btn" disabled>Checkout</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Logic -->
    <script>
        // --- Cart Logic ---
        const cart = JSON.parse(localStorage.getItem('miniStoreCart')) || [];
        const cartBadge = document.getElementById('cart-badge');
        const cartItemsContainer = document.getElementById('cart-items-container');
        const cartTotalEl = document.getElementById('cart-total');
        const checkoutBtn = document.getElementById('checkout-btn');

        // Update UI on load
        updateCartUI();

        // Add to Cart Event Listeners
        document.querySelectorAll('.add-to-cart').forEach(button => {
            button.addEventListener('click', () => {
                const product = {
                    id: button.dataset.id,
                    name: button.dataset.name,
                    price: parseFloat(button.dataset.price),
                    priceId: button.dataset.priceId,
                    image: button.dataset.image,
                    quantity: 1
                };
                addToCart(product);
            });
        });

        function addToCart(product) {
            const existingItem = cart.find(item => item.id === product.id);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push(product);
            }
            saveCart();
            updateCartUI();
            
            // Show feedback (optional toast or animation)
            const btn = document.querySelector(`button[data-id="${product.id}"]`);
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<i class="bi bi-check-lg"></i>';
            setTimeout(() => {
                btn.innerHTML = originalContent;
            }, 1000);
        }

        function removeFromCart(productId) {
            const index = cart.findIndex(item => item.id === productId);
            if (index > -1) {
                cart.splice(index, 1);
                saveCart();
                updateCartUI();
            }
        }

        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    saveCart();
                    updateCartUI();
                }
            }
        }

        function saveCart() {
            localStorage.setItem('miniStoreCart', JSON.stringify(cart));
        }

        function updateCartUI() {
            // Update Badge
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            if (totalItems > 0) {
                cartBadge.style.display = 'block';
                cartBadge.textContent = totalItems;
                checkoutBtn.disabled = false;
            } else {
                cartBadge.style.display = 'none';
                checkoutBtn.disabled = true;
            }

            // Update Modal Content
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p class="text-center my-4">Your cart is empty.</p>';
                cartTotalEl.textContent = '0.00';
                const modalEl = document.getElementById('cartModal');
                if (modalEl && modalEl.classList.contains('show')) {
                    if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {
                        const instance = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
                        instance.hide();
                    } else {
                        modalEl.classList.remove('show');
                        modalEl.style.display = 'none';
                    }
                }
            } else {
                let html = '<div class="list-group list-group-flush">';
                let total = 0;

                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    html += `
                        <div class="list-group-item bg-transparent d-flex align-items-center justify-content-between px-0">
                            <div class="d-flex align-items-center">
                                <img src="${item.image}" alt="${item.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 6px;" class="me-3">
                                <div>
                                    <h6 class="mb-0">${item.name}</h6>
                                    <small class="text-muted-custom">$${item.price.toFixed(2)} x ${item.quantity}</small>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="btn-group btn-group-sm me-3" role="group">
                                    <button type="button" class="btn btn-outline-secondary" onclick="updateQuantity('${item.id}', -1)">-</button>
                                    <button type="button" class="btn btn-outline-secondary" disabled>${item.quantity}</button>
                                    <button type="button" class="btn btn-outline-secondary" onclick="updateQuantity('${item.id}', 1)">+</button>
                                </div>
                                <span class="fw-bold me-3">$${itemTotal.toFixed(2)}</span>
                                <button class="btn btn-sm btn-outline-danger" onclick="removeFromCart('${item.id}')"><i class="bi bi-trash"></i></button>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                cartItemsContainer.innerHTML = html;
                cartTotalEl.textContent = total.toFixed(2);
            }
        }

        // Checkout Logic
        checkoutBtn.addEventListener('click', async () => {
            if (
                location.protocol === 'file:' ||
                location.hostname === '127.0.0.1' ||
                location.hostname === 'localhost'
            ) {
                alert('Checkout only works on the deployed site. Please use your Vercel URL.');
                return;
            }
            const originalText = checkoutBtn.innerText;
            checkoutBtn.innerText = 'Processing...';
            checkoutBtn.disabled = true;

            try {
                const itemsForCheckout = cart.map(item => ({
                    id: item.id,
                    name: item.name,
                    price: item.price,
                    priceId: item.priceId,
                    image: item.image,
                    quantity: item.quantity
                }));
                sessionStorage.setItem('miniStoreCartBackup', JSON.stringify(itemsForCheckout));
                cart.splice(0, cart.length);
                saveCart();
                updateCartUI();
                const response = await fetch('/api/checkout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ items: itemsForCheckout })
                });

                const data = await response.json();

                if (response.ok) {
                    sessionStorage.removeItem('miniStoreCartBackup');
                    window.location.href = data.url;
                } else {
                    alert('Checkout Error: ' + (data.error || 'Unknown error'));
                    checkoutBtn.innerText = originalText;
                    checkoutBtn.disabled = false;
                    const backup = sessionStorage.getItem('miniStoreCartBackup');
                    if (backup) {
                        const restored = JSON.parse(backup);
                        cart.splice(0, cart.length, ...restored);
                        saveCart();
                        updateCartUI();
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
                checkoutBtn.innerText = originalText;
                checkoutBtn.disabled = false;
                const backup = sessionStorage.getItem('miniStoreCartBackup');
                if (backup) {
                    const restored = JSON.parse(backup);
                    cart.splice(0, cart.length, ...restored);
                    saveCart();
                    updateCartUI();
                }
            }
        });

        // Back To Top Logic
        (function initBackToTop() {
            const backToTopBtn = document.getElementById('backToTopBtn');
            if (!backToTopBtn) return;

            window.addEventListener('scroll', () => {
                if (window.scrollY > 200) {
                    backToTopBtn.classList.add('show');
                } else {
                    backToTopBtn.classList.remove('show');
                }
            });

            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        })();

        // --- Dark/Light Mode Management ---
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const htmlElement = document.documentElement;
        const navbar = document.querySelector('.navbar');
        const footer = document.querySelector('.footer-custom');

        // Check local storage or system preference
        const storedTheme = localStorage.getItem('theme');
        const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        const currentTheme = storedTheme || 'dark'; // Default to dark as requested

        // Apply theme on initial load
        setTheme(currentTheme);

        // Toggle Theme Event Listener
        themeToggle.addEventListener('click', () => {
            const newTheme = htmlElement.getAttribute('data-bs-theme') === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
            localStorage.setItem('theme', newTheme);
        });

        /**
         * Applies the selected theme to the entire application.
         * Updates Body, Navbar, Footer, Buttons, and Icons.
         * @param {string} theme - 'dark' or 'light'
         */
        function setTheme(theme) {
            htmlElement.setAttribute('data-bs-theme', theme);
            
            // Select all cards and buttons to update their styles
            const cards = document.querySelectorAll('.card');
            const buyButtons = document.querySelectorAll('.buy-button');
            const addToCartButtons = document.querySelectorAll('.add-to-cart');
            
            if (theme === 'dark') {
                // --- Apply Dark Mode Styles ---
                themeIcon.className = 'bi bi-moon-fill';
                themeIcon.style.color = '#fff';
                
                // Navbar
                navbar.classList.remove('navbar-light', 'bg-white');
                navbar.classList.add('navbar-dark', 'bg-dark');
                
                // Body
                document.body.style.backgroundColor = '#2b3035';
                document.body.style.color = '#f8f9fa';

                // Footer
                footer.classList.remove('bg-light', 'text-dark');
                footer.classList.add('bg-dark', 'text-light');
                
                // Buttons
                buyButtons.forEach(btn => {
                    btn.classList.remove('btn-dark');
                    btn.classList.add('btn-light');
                });

                // Add to Cart Buttons
                addToCartButtons.forEach(btn => {
                    btn.classList.remove('btn-outline-dark');
                    btn.classList.add('btn-outline-light');
                });

            } else {
                // --- Apply Light Mode Styles ---
                themeIcon.className = 'bi bi-sun-fill';
                themeIcon.style.color = '#fdb813'; // Sun yellow
                
                // Navbar
                navbar.classList.remove('navbar-dark', 'bg-dark');
                navbar.classList.add('navbar-light', 'bg-white');
                
                // Body
                document.body.style.backgroundColor = '#ffffff'; // Explicit white
                document.body.style.color = '#212529'; // Dark text

                // Footer
                footer.classList.remove('bg-dark', 'text-light');
                footer.classList.add('bg-light', 'text-dark');
                
                // Buttons (Invert for contrast)
                buyButtons.forEach(btn => {
                    btn.classList.remove('btn-light');
                    btn.classList.add('btn-dark');
                });

                // Add to Cart Buttons
                addToCartButtons.forEach(btn => {
                    btn.classList.remove('btn-outline-light');
                    btn.classList.add('btn-outline-dark');
                });
            }
        }

        // Set current year in footer
        document.getElementById("year").textContent = new Date().getFullYear();

        // --- Unit Tests: Theme toggle button halo persistence ---
        (function runThemeToggleTestsIfRequested() {
            const params = new URLSearchParams(window.location.search);
            if (params.get('runTests') !== 'theme') return;

            const originalTheme = localStorage.getItem('theme');
            const btn = document.querySelector('.buy-button');
            function boxShadowHasWhite(el) {
                const bs = getComputedStyle(el).boxShadow || '';
                return bs.includes('255'); // rgba(255,255,255,0.xx)
            }
            function boxShadowHasBlack(el) {
                const bs = getComputedStyle(el).boxShadow || '';
                // prefer '0, 0, 0' presence
                return bs.includes('0, 0, 0');
            }
            function assert(ok, name) {
                console.log((ok ? 'PASS' : 'FAIL') + ' - ' + name);
            }

            // dark -> light -> dark
            setTheme('dark'); localStorage.setItem('theme','dark');
            assert(btn.classList.contains('btn-light'), 'Dark: btn-light applied');
            assert(boxShadowHasWhite(btn), 'Dark: halo is white');

            setTheme('light'); localStorage.setItem('theme','light');
            assert(btn.classList.contains('btn-dark'), 'Light: btn-dark applied');
            assert(boxShadowHasBlack(btn), 'Light: halo is black');

            setTheme('dark'); localStorage.setItem('theme','dark');
            assert(btn.classList.contains('btn-light'), 'Dark again: btn-light applied');
            assert(boxShadowHasWhite(btn), 'Dark again: halo reverted to white');

            // light -> dark -> light
            setTheme('light'); localStorage.setItem('theme','light');
            assert(btn.classList.contains('btn-dark'), 'Light start: btn-dark applied');
            assert(boxShadowHasBlack(btn), 'Light start: halo black');

            setTheme('dark'); localStorage.setItem('theme','dark');
            assert(btn.classList.contains('btn-light'), 'Dark mid: btn-light applied');
            assert(boxShadowHasWhite(btn), 'Dark mid: halo white');

            setTheme('light'); localStorage.setItem('theme','light');
            assert(btn.classList.contains('btn-dark'), 'Light end: btn-dark applied');
            assert(boxShadowHasBlack(btn), 'Light end: halo black');

            if (originalTheme) {
                setTheme(originalTheme);
                localStorage.setItem('theme', originalTheme);
            }
        })();
    </script>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
